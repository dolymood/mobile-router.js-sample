!function(t,e){"function"==typeof define&&(define.amd||define.cmd)?define("m",function(exports){return e(t,exports)}):t.M=e(t,{})}(this,function(t,e){function n(t){if(!("classList"in t)){t.classList={node:t};for(var e in x)t.classList[e.slice(1)]=x[e]}return t.classList}var i=function(t,e,n){n||(n=null);for(var i=0,r=t.length;i<r&&!1!==e.call(n,t[i],i,t);i++);},r=function(t){return t+="",t.replace(/#.*/,"")},a=t.location,s=t.document,o=s.body,h=s.createElement("a"),u=function(t){return h.href=t,d(h)},c=function(t){return h.href=t,r(h.href)},l=function(t){t||(t=a);var e=t.hash;return"#"===e.charAt(0)&&(e=e.substr(1)),e},d=function(t){t||(t=a);var e=t.href,n=l(t),i=r(e);return n||(e=i),{url:e,rurl:i,host:t.host,hash:n,protocol:t.protocol,origin:t.origin||t.protocol+"//"+t.host,pathname:t.pathname,search:t.search,port:t.port}},f=function(t){var e="";do if(t!==o&&1===t.nodeType&&((e=t.getAttribute("data-href"))||(e=t.href)))break;while(t=t.parentElement);return{href:e||"",target:t}},p=function(t){return t.indexOf("-")<0?t:t.replace(/-[^-]/g,function(t){return t.charAt(1).toUpperCase()})},v=function(t){var e={};if(t.dataset)for(var n in t.dataset)e[n]=t.dataset[n];else for(var i,r,a=t.attributes,s=/^data-(.+)$/i,o=0,h=a.length;o<h;o++)i=a[o].name||a[o].nodeName,(r=i.match(s))&&(e[p(r[1])]=a[o].value||a[o].nodeValue);return e},g=Object.prototype,m=(g.hasOwnProperty,g.toString),y=function(t){return"[object Function]"==m.call(t)},w=function(t){return"[object Object]"===m.call(t)&&Object.getPrototypeOf(t)===g},C=e.extend=function(){var t,e,n,i,r,a,s=arguments[0]||{},o=1,h=arguments.length,u=!1;for("boolean"==typeof s&&(u=s,s=arguments[1]||{},o++),"object"==typeof s||y(s)||(s={}),o===h&&(s=this,o--);o<h;o++)if(null!=(t=arguments[o]))for(e in t)n=s[e],i=t[e],s!==i&&(u&&i&&(w(i)||(r=Array.isArray(i)))?(r?(r=!1,a=n&&Array.isArray(n)?n:[]):a=n&&w(n)?n:{},s[e]=C(u,a,i)):void 0!==i&&(s[e]=i));return s};e.nextTick=new function(){function e(){for(var t=r.length,e=0;e<t;e++)r[e]();r=r.slice(t)}var n=t.setImmediate,i=t.MutationObserver;if(n)return n.bind(t);var r=[];if(i){var a=s.createTextNode("M");return new i(e).observe(a,{characterData:!0}),function(t){r.push(t),a.data=Math.random()}}return function(t){setTimeout(t)}};var S={_eventData:null,on:function(t,e){this._eventData||(this._eventData={}),this._eventData[t]||(this._eventData[t]=[]);var n=!1;i(this._eventData[t],function(t){if(t===e)return n=!0,!1}),n||this._eventData[t].push(e)},off:function(t,e){this._eventData||(this._eventData={}),this._eventData[t]&&this._eventData[t].length&&(e?i(this._eventData[t],function(n,i){if(n===e)return this._eventData[t].splice(i,1),!1}):this._eventData[t]=[])},trigger:function(t){if(this._eventData||(this._eventData={}),this._eventData[t]){var e=this._eventData[t].slice.call(arguments,1);i(this._eventData[t],function(t){t.apply(null,e)})}}},b=function(){},k="m-"+(new Date).getTime()+"-",_=1,A={},T=function(t){var e="";return t&&(e=A[t])||(e=k+_++,t&&(A[t]=e)),e},V=/[^, ]+/g,E=/^\[object SVG\w*Element\]$/,x={_toString:function(){var t=this.node,e=t.className,n="string"==typeof e?e:e.baseVal;return n.split(/\s+/).join(" ")},_contains:function(t){return(" "+this+" ").indexOf(" "+t+" ")>-1},_add:function(t){this.contains(t)||this._set(this+" "+t)},_remove:function(t){this._set((" "+this+" ").replace(" "+t+" "," "))},__set:function(t){t=t.trim();var e=this.node;E.test(e)?e.setAttribute("class",t):e.className=t}};return"add,remove".replace(V,function(t){e[t+"Class"]=function(e,i){return i&&"string"==typeof i&&e&&1===e.nodeType&&i.replace(/\S+/g,function(i){n(e)[t](i)}),this}}),"undefined"!=typeof $&&y($.prototype.html)?e.innerHTML=function(t,e){$(t).html(e)}:e.innerHTML=function(t,e){t.innerHTML=e},e.extend({rword:V,noop:b,each:i,trimUrl:r,parseUrl:u,getHash:l,getFullUrl:c,getHrefAndTarget:f,camelize:p,getDatesetObj:v,isFunction:y,isArray:function(t){return Array.isArray(t)},isString:function(t){return"string"==typeof t},isUndefined:function(t){return"undefined"==typeof t},isDefined:function(t){return"undefined"!=typeof t},isPlainObject:w,parseLocation:d,getUIDByKey:T,hasClass:function(t,e){return 1===t.nodeType&&n(t).contains(e)},location:a,document:s,body:o,html:s.documentElement,Base:S,extendByBase:function(t){return C(t,S)},Array:{ensure:function(t,e){if(t.indexOf(e)===-1)return t.push(e)},indexOfByKey:function(t,e,n){for(var i=e[n],r=0,a=t.length;r<a;r++)if(t[r][n]===i)return r;return-1}}}),e}),function(t,e){"function"==typeof define&&(define.amd||define.cmd)?define("m.history",function(require){var n=require("m");return n.history=e(t,n),n}):M.history=e(t,t.M)}(this,function(t,e){var n={},i=[],r=function(t){return("/"+t+"/").replace(/^\/+|\/+$/g,"/")},a=e.document.getElementsByTagName("base");a=a&&a.length?r(a[0].getAttribute("href")):"/";var s=e.parseLocation().origin,o=t.history,h=(t.navigator||{}).userAgent;h||(h="");var u=parseInt((/android (\d+)/.exec(h.toLowerCase())||[])[1],10);isNaN(u)&&(u=void 0);var c=/Boxee/i.test(h),l=!(!(o&&o.pushState&&o.replaceState)||u<4||c),d={support:l,_startd:!1,index:-1,base:a,start:function(n){if(!this._startd){n||(n={});var i=n.base;e.isDefined(i)&&e.isString(i)&&(this.base=r(i)),this._startd=!0,this.options=e.extend({enablePushState:!0},n),l&&(this.options.enablePushState&&t.addEventListener("popstate",this.onChange),e.document.addEventListener("click",this.onDocClick)),this.onChange({type:"popstate",state:d.getUrlState(e.location.href)}),this.trigger("inited")}},stop:function(){l&&(this.options.enablePushState&&t.removeEventListener("popstate",this.onChange),e.document.removeEventListener("click",this.onDocClick)),this._startd=!1,this.index=-1,n={},i=[]},getPath:function(t){var n=e.parseUrl(t),i=decodeURIComponent(n.pathname+n.search),r=this.base.slice(0,-1);return i.indexOf(r)||(i=i.slice(r.length)),i.slice(1)},onDocClick:function(t){if(t.which>1||t.metaKey||t.ctrlKey||t.shiftKey||t.altKey)return!0;var n=t.target,i=e.getHrefAndTarget(n);n=i.target;var r=i.href;if(d.checkUrl(r)&&!n.target){var a=e.getDatesetObj(n),s=d.createStateObject(r,a);return t.preventDefault(),d.pushState(s,!0),!1}},checkUrl:function(t,n){n||(n=e.parseUrl(t).origin);var i=/^javascript:/;return t&&s===n&&!i.test(t)},push:function(t,e){var n=this.createStateObject(t,e);this.pushState(n)},pushState:function(t,n){(n||this.checkUrl(t.url,t.origin))&&t.url!==d.getCurrentState().url&&(this.options.enablePushState&&e.isUndefined(t.data.href)&&t.url!==e.location.href&&o["true"==t.replace?"replaceState":"pushState"](t,t.title,t.url),this.onChange({state:t}))},onChange:function(t){var n,i=t&&t.state||d.getUrlState(e.location.href),r=d.getCurrentState();if(r&&i.rurl===r.rurl)return void("popstate"!==t.type&&i.hash&&(n=e.document.getElementById(i.hash),n&&n.scrollIntoView()));var a=d.storeState(i),s="";if(a>d.index)s="forward";else{if(!(a<d.index))return t.preventDefault(),!1;s="back"}"back"!==s&&"back"===i.data.rel?s="back":"back"===s&&"back"!==i.data.rel&&"back"===r.data.rel&&(s="forward"),e.document.title=i.title,d.index=a,d.trigger(s,i,r),d.trigger("change",s,i,r)},getUrlState:function(t){return t=e.getFullUrl(t),n[t]||this.createStateObject(t)},getCurrentState:function(){var t=i[this.index];return t?n[t]||null:null},getPrevState:function(){var t=i[this.index-1];return t?n[t]||null:null},createStateObject:function(t,n,i){t?"/"===t.charAt(0)&&(t=t.slice(1),t=this.base+t):t=e.location.href;var r=e.parseUrl(t);return{data:n||(n={}),title:i||n.title||e.document.title,rurl:r.rurl,url:r.url,origin:r.origin,hash:r.hash}},hasUrl:function(t){return!!n[t]},storeState:function(t){var r=-1,a=t.rurl;return this.hasUrl(a)?r=i.indexOf(a):(r=this.index+1,i.splice(r,0,a)),n[a]=e.extend(!0,n[a],t),this.clearCache(r),r},clearCache:function(t){e.isUndefined(t)&&(t=-1);var r=t+5,a=i.slice(r);a.forEach(function(t){delete n[t]}),i.length>r&&(i.length=r)},getCache:function(){return{urlCache:i,stateCache:n}}};return e.extendByBase(d),d}),function(t,e){"function"==typeof define&&(define.amd||define.cmd)?define("m.router",function(require){var n=require("m.history");return n.router=e(t,n,n.history),n}):M.router=e(t,M,M.history)}(this,function(t,e,n){function i(t,n,i){t?(t.setRouteView(this),this.$parentRoute=t):this.$parentRoute=null,n&&(this.$parent=n),this.routes=[],this.maskEle=null,this.pageViewState=null,this.viewsContainer=null,this.routeIns=null,this.options=i,this.pagesCache=[],this.templateCache={},this.options.cacheViewsNum<1&&(this.options.cacheViewsNum=1),t||this.setViewsContainer(e.document.body)}function r(t,n,i){i=i||{},i.callback=n||e.noop,t.length>2&&"/"===t.charAt(t.length-1)&&(t=t.slice(0,-1),i.last="/"),i=h(t,i),delete i.path,delete i.last,this.routeView=null,this.instances=[],this.path=t,this.activeIndex=-1,e.each(["cacheTemplate","animation","aniClass","redirectTo","redirectPushState","callback","getTemplate","onActive","onDestroy","onEnter","onLeave","regexp","$regexp","keys","parentArgsLen"],function(t){this[t]=i[t],delete i[t]},this);var r=this.redirectTo;e.isString(r)&&(this.redirectTo=function(){return r}),this.redirectTo&&e.isUndefined(this.redirectPushState)&&(this.redirectPushState=!0),this.parentArgsLen||(this.parentArgsLen=0),this.options=i}function a(t,e,n,i,r){this.route=t,this.path=e,this.query=n,this.options=r,this.params={},this.args=null,this.element=null,this.cached=!1,this._oldTemplate="",this.destroyed=!1,this.setArgs(i)}function s(t){var e=n.getPath(t);return e||n.base?(e&&"/"===e||(e="/"+(e||"")),d(e)):null}function o(t,n){var i=t.route[n];return e.isFunction(i)&&i.apply(t,t.args)}function h(t,e){for(var n,i,r,a,s=e.keys=[],o="boolean"!=typeof e.caseInsensitive||e.caseInsensitive,h="^",c=0;n=v.exec(t);){i=n[2]||n[3],r=n[4]||("*"==n[1]?".*":"string"),a=t.substring(c,n.index);var l=k.$types[r],d={name:i};l&&(r=l.pattern,d.decode=l.decode),s.push(d),h+=u(a,r,!1),c=v.lastIndex}return a=t.substring(c),h+=u(a),e.children&&(e.$regexp=new RegExp(h,o?"i":void 0)),h+=(e.strict?e.last:"/?")+"$",e.regexp=new RegExp(h,o?"i":void 0),e}function u(t,e,n){var i=t.replace(/[\\\[\]\^$*+?.()|{}]/g,"\\$&");if(!e)return i;var r=n?"?":"";return i+r+"("+e+")"+r}function c(t,e,n){for(var i=0,r=e.length;i<r;i++){var a=e[i],s=t[i]||"";if("function"==typeof a.decode)var o=a.decode(s);else try{o=JSON.parse(s)}catch(h){o=s}t[i]=n.params[a.name]=o}n.args=t}function l(t){var e=t.args;if(!e)return void(t.args=[]);if(t.route.keys.length){var n=t.route.parentArgsLen;e.splice(0,n)}else e.length=0}function d(t){var e=t.split("?"),n={},i=e[0],r=e[1];if(r)for(var a,s=r.split("&"),o=s.length,h=0;h<o;h++)s[h]&&(a=s[h].split("="),n[decodeURIComponent(a[0])]=decodeURIComponent(a[1]));return{path:i,query:n}}function f(t){var n;t&&(n=e.document.getElementById(t),n&&n.scrollIntoView())}function p(t){t&&t.parentNode&&t.parentNode.removeChild(t)}var v=/([:*])(\w+)|\{(\w+)(?:\:((?:[^{}\\]+|\\.|\{(?:[^{}\\]+|\\.)*\})+))?\}/g,g=!1,m="page-view",y="in",w={cacheTemplate:!0,viewsSelector:"",viewClass:"",animation:!0,aniClass:"slide",maskClass:"mask",showLoading:!0,cacheViewsNum:3},C=Object.keys(w),S=e.document.createElement("div"),b=function(){for(var t,e=S.style,n=["a","webkitA","MozA","OA","msA"],i=["animationend","webkitAnimationEnd","animationend","oAnimationEnd","MSAnimationEnd"],r=0,a=n.length;r<a;r++)if(t=n[r]+"nimation",t in e)return i[r];return"animationend"}();e.extend(i.prototype,{route:function(t,n,i,r,a){var s=this.routes;i||(i={});for(var o,h,u,c=!1,l=this,d=0;o=s[d];d++){var f=t.match(r&&o.$regexp||o.regexp);if(f){h=f.shift(),u=o.ins(h,n||{},f,i);for(var p,v,g=l;g&&(p=g.$parentRoute);){if(v=p.getActive(),!l.viewsContainer||!v||!v.isParentOf(u.path))return l.$parent.route(u.path,u.query,e.extend({matchIns:u},i),t,function(){delete l.$parent.pageViewState.options.matchIns,l.pageViewState&&l.pageViewState.path===t||(l._waiting=!0,l._route(u,a))}),!0;g=g.$parent}l._route(u,a),c=!0}else r||o.routeView&&(c=o.routeView.route(t,n,i));if(c)break}return c},_redirectTo:function(t,n){function i(){!t.element&&a.destroyIns(t);var i={};n||(i.redirectToSync=!0),a.redirectPushState||(i.href=r),e.router.navigate(r,i)}var r,a=t.route;return!(!a.redirectTo||!(r=o(t,"redirectTo"))||t.equalTo(r,!0))&&(n?e.nextTick(i):i(),!0)},_getDefaultEle:function(t){var n,i=e.getUIDByKey(t.path);return!t.options.first||!(n=this.viewsContainer.getElementsByClassName(m)[0])||n.id&&n.id!==i?null:n},_checkInsActive:function(t){return this.routeIns===t},_route:function(t,n){function i(e){a.getTemplateCb(t,e,n)}this.routeIns&&this.routeIns.endCall&&this.routeIns.endCall(),this.routeIns=t;var r=t.route,a=this,s=this.getOption(r,t.options.state,"cacheTemplate"),h=(e.getUIDByKey(t.path),this._getDefaultEle(t));if(h){var u=h.getElementsByClassName(m),c=[];e.each(u,function(t){t.parentNode==h&&(p(t),c.push(t))}),this.templateCache[t.path]=h.innerHTML,s=!0,e.each(c,function(t){h.appendChild(t)}),u=null,c=null}e.isString(s)&&(s="true"===s),t.options.first=t.options.first||!this.pageViewState;var l=t.args;if(s&&this.templateCache[t.path]||!r.getTemplate){if(!r.getTemplate&&!n&&this._redirectTo(t,!0))return;o(t,"onActive"),k.trigger("routeChangeStart",t,l),i(this.templateCache[t.path])}else o(t,"onActive"),k.trigger("routeChangeStart",t,l),this.showLoading(),r.getTemplate.length>0?(this._waiting=!1,r.getTemplate.call(t,i)):i(r.getTemplate.call(t))},setViewsContainer:function(t){var e,n;t&&(n=this.options.viewsSelector,e=n&&t.querySelector(n)),this.viewsContainer=e||t||null},showLoading:function(t){(this.options.showLoading||t)&&(this.maskEle||this.initMaskEle(),this.maskEle.style.visibility="visible")},initMaskEle:function(){this.maskEle=S.cloneNode(),this.maskEle.className=this.options.maskClass,this.maskEle.innerHTML='<i class="'+this.options.maskClass+'-loading"></i>',this.viewsContainer.appendChild(this.maskEle)},hideLoading:function(){this.maskEle&&(this.maskEle.style.visibility="hidden")},getOption:function(t,n,i){if((t||n)&&i){var r;return n&&(r=n.data[i]),e.isUndefined(r)&&(r=t[i],e.isUndefined(r)&&(r=this.options[i])),r}},getTemplateCb:function(t,n,i){function r(){var n=e.Array.indexOfByKey(c.pagesCache,t,"path");~n&&c.pagesCache.splice(n,1),c.pagesCache.push(t),s(),h()}function a(){return t.endCall===e.noop||t.destroyed?void(t.endCall=e.noop):(s(),o(t,"onEnter"),h(),void(t.endCall=e.noop))}function s(){v&&w&&(!w.defaultTemplate&&t.cached||(e.innerHTML(f,n),t.cached=!1))}function h(){w&&w.setViewsContainer(t.element),o(t,"callback"),k.trigger("routeChangeEnd",t,t.args),i&&i(),delete c._waiting,!m&&!i&&c._redirectTo(t)}if(this.hideLoading(),this._checkInsActive(t)){t._oldTemplate=this.templateCache[t.path],this.templateCache[t.path]=n||"";var u,c=this,l=t.options,d=e.getUIDByKey(t.path);l.first&&(u=this._getDefaultEle(t),p(this.maskEle),this.viewsContainer&&this.$parentRoute&&this.viewsContainer!==this.$parentRoute.ele()&&(this.defaultTemplate=this.viewsContainer.innerHTML,u||(e.innerHTML(this.viewsContainer,""),this.maskEle=null)),this.maskEle&&this.viewsContainer.appendChild(this.maskEle));var f=e.document.getElementById(d);f?t.cached=!0:(f=u||e.document.createElement("div"),f.id=d,t.cached=!1,!u&&this.viewsContainer.appendChild(f));var v=e.hasClass(f,y),g=t.route,m=!1;if(v&&t.element===f&&c._redirectTo(t,!0))return m=!0,void a();(t.cached||u)&&n===t._oldTemplate||(v||e.innerHTML(f,n),t.cached=!1);var w=g.routeView;if(w){var C=w.pageViewState;if(v)return void(C&&C!==t.options.matchIns?w._transView(null,C,l,a):a());if(C){var S,b=t.options.matchIns,_=!1;if(b){S=b.route;for(var A,T=w;!_&&T&&T.pageViewState;)A=T.pageViewState.route.routeView,S==T.pageViewState.route?(_=!0,b.path!==T.pageViewState.path&&T._transView(null,T.pageViewState,l),A&&A.pageViewState&&A._transView(null,A.pageViewState,l)):T=A}_||w._transView(null,C,l)}}this._transView(f,t,l,r)}},_transView:function(t,n,i,r){function a(t,e){setTimeout(function(){e&&t.removeEventListener(b,e)})}function s(){return t?void h():(n.endCall(),h(),S.pageViewState=null,void(S.defaultTemplate&&e.innerHTML(S.viewsContainer,S.defaultTemplate)))}function h(){setTimeout(function(){e.removeClass(S.viewsContainer,g)},100),T&&V&&S.checkPageViews()}var u=y,c="out",l=c,d="reverse",p="ani",v=u+" "+d,g="overhidden",w=this.pageViewState,C=w&&w.element,S=this;this.pageViewState=n,t&&(e.removeClass(t,v),e.addClass(t,m+" "+this.options.viewClass)),n.endCall=function(){return n.endCall===e.noop||n.destroyed?void(n.endCall=e.noop):(r&&r.apply(this,arguments),void(n.endCall=e.noop))},n.setEle(t);var k=this._shouldAni(this.options.animation,n,i);if(k=k&&!!r&&!n.redirectTo&&!n.options.state.data.redirectToSync){var _=p,A=p;_+=" "+this.getOption(n.route,i.state,"aniClass"),i.first||(A+=" "+this.getOption(w.route,i.oldState,"aniClass")),u=_+" "+u,c=A+" "+c,e.addClass(this.viewsContainer,g)}"back"===i.direction&&(u+=" "+d,c+=" "+d),C&&(e.removeClass(C,v),e.addClass(C,c),C.offsetWidth=C.offsetWidth,o(w,"onLeave"),w.route.getActive()===w&&w.route.setActive(-1)),t&&(e.removeClass(t,l),e.addClass(t,u),t.offsetWidth=t.offsetWidth,o(n,"onEnter")),!n.cached&&i.state.hash&&f(i.state.hash);var T=!1,V=!1;return k?(t&&t.addEventListener(b,function E(){T=!0,a(t,E),e.removeClass(t,_),n.endCall(),h()}),void(C&&C.addEventListener(b,function x(){V=!0,a(C,x),e.removeClass(C,A),s()}))):(T=!0,V=!0,n.endCall(),void s())},_shouldAni:function(t,e,n){var i=this.getOption(e.route,n.state,"animation"),r=t;return n.first||(r=this.getOption(this.pageViewState.route,n.oldState,"animation")),i=1==i||"true"==i,r=1==r||"true"==r,t=i&&r&&(!this._waiting||!n.first),n.first&&(t=t&&!!this.$parentRoute),t},checkPageViews:function(){var t=this.options.cacheViewsNum,n=this.pagesCache;if(!(n.length<=t)){var i=e.Array.indexOfByKey(n,this.pageViewState,"path"),r=0,a=0;for(r=i-Math.floor((t-1)/2),r<0&&(r=0),a=t-1+r,a>n.length-1&&(r-=a-n.length+1,a=n.length-1);r>0;)this.destroyRouteIns(n.shift()),r--,a--;for(;a<n.length-1;)this.destroyRouteIns(n.pop())}},destroyRouteIns:function(t){if(!t.destroyed){var e=t.route,n=e.routeView,i=this.pageViewState&&this.pageViewState.route;if(n&&(!n.pageViewState||e!==i)){for(var r=n.pagesCache.shift();r;)n.destroyRouteIns(r),r=n.pagesCache.shift();n.pageViewState=null,i&&e.ele()==this.pageViewState.element||n.setViewsContainer(null),p(n.maskEle),n.maskEle=null}o(t,"onDestroy"),e.destroyIns(t),t=null}},getTemplateCache:function(){return this.templateCache}}),e.extend(r.prototype,{ins:function(t,n,i,r){var s=this,o=null;return e.each(s.instances,function(e,a){if(s.checkEqual(e,t,n))return o=e,s.setActive(a),o.setOptions(r),o.setArgs(i),!1}),o?o:(o=new a(this,t,n,i,r),this.instances.push(o),this.setActive(this.instances.length-1),o)},checkEqual:function(t,e,n){return t.path===e},getIns:function(t){return this.instances[t]},getActive:function(){return this.getIns(this.activeIndex)},setActive:function(t){this.activeIndex=t},setRouteView:function(t){this.routeView=t},ele:function(){var t=this.getActive()||null;return t&&t.element},destroyIns:function(t){if(t){return this.getActive()===t?(this.instances.splice(this.activeIndex,1),this.setActive(-1),void t.destroy()):void e.each(this.instances,function(e,n){if(e===t)return this.instances.splice(n,1),this.activeIndex>n&&this.setActive(this.activeIndex-1),t.destroy(),!1},this)}}}),e.extend(a.prototype,{setArgs:function(t){this.route.keys.length?(c(t,this.route.keys,this),l(this)):this.args=[]},setOptions:function(t){this.destroyed||(this.options=t)},setEle:function(t){this.element=t},equalTo:function(t,e){var n=s(t);return!(!n||!this.route.checkEqual(this,n.path,n.query))&&(e&&(this.query=n.query),!0)},isParentOf:function(t){var e=this.route.$regexp;if(e){var n=t.match(e);if(n&&n[0]===this.path)return!0}return!1},destroy:function(){this.destroyed||(this.route=null,this.path="",this.query=null,this.options=null,this.params=null,this.args=null,this.element&&p(this.element),this.element=null,this.destroyed=!0)}});var k={errorback:null,init:function(t,n){if(!g&&(t||n)){g=!0,e.isArray(t)||(n=t,t=[]),n&&e.isFunction(n.error)&&(this.error(n.error),delete n.error);var r={};e.extend(r,w,n||{}),this.routeView=new i(null,null,r),this._add(t)}},route:function(t,e,n){t=t.trim();var i=this.routeView.route(t,e,n);!i&&this.errorback&&this.errorback(t,e,n)},error:function(t){this.errorback=t},_add:function(t,n,i,r){var a;i||(i=""),e.each(t,function(t){a=t.path;var e=0;i&&("/"===i&&(i=""),a=i+a,r.parentArgsLen&&(e+=r.parentArgsLen),e+=r.keys.length,t.parentArgsLen=e),this.add(a||"/",t.callback,t,n)},this)},add:function(t,n,a,s){"object"==typeof n&&(s=a,a=n),s||(s=this.routeView);var o=s.routes;if("/"!==t.charAt(0))throw"path必须以/开头";var h=new r(t,n,a);e.Array.ensure(o,h);var u=a.children;if(u){delete a.children;var c={},l=s.options;e.each(C,function(t){t in u?c[t]=u[t]:c[t]=l[t]});var d=new i(h,s,c);routes=u.routes,delete u.routes,this._add(routes,d,t,h)}},navigate:function(t,e){"/"===t.charAt(1)&&(t=t.slice(1)),n.push(t,e)},$types:{date:{pattern:"[0-9]{4}-(?:0[1-9]|1[0-2])-(?:0[1-9]|[1-2][0-9]|3[0-1])",decode:function(t){return new Date(t.replace(/\-/g,"/"))}},string:{pattern:"[^\\/]*"},bool:{pattern:"0|1",decode:function(t){return 0!==parseInt(t,10)}},"int":{pattern:"\\d+",decode:function(t){return parseInt(t,10)}}}};return e.extendByBase(k),n.on("change",function(t,e,n){var i=!1;n||(i=!0);var r=s(e.url);r&&k.route(r.path,r.query,{first:i,direction:t,state:e,oldState:n})}),k});