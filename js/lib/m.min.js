!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.M=t():e.M=t()}(this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var module=n[i]={exports:{},id:i,loaded:!1};return e[i].call(module.exports,module,module.exports,t),module.loaded=!0,module.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(module,exports,e){var t=e(1),n=e(3),i=e(4),r=e(6),a=t.history,s=!1,o={cacheTemplate:!0,viewsSelector:"",viewClass:"",animation:!0,aniClass:"slide",maskClass:"mask",showLoading:!0,cacheViewsNum:3},h=Object.keys(o),c={errorback:null,init:function(e,n){if(!s&&(e||n)){s=!0,t.isArray(e)||(n=e,e=[]),n&&t.isFunction(n.error)&&(this.error(n.error),delete n.error);var i={};t.extend(i,o,n||{}),this.routeView=new r(null,i),this._add(e)}},route:function(e,t,n){e=e.trim();var i=this.routeView.route(e,t,n);!i&&this.errorback&&this.errorback(e,t,n)},error:function(e){this.errorback=e},_add:function(e,n,i,r){var a;i||(i=""),t.each(e,function(e){a=e.path;var t=0;i&&("/"===i&&(i=""),a=i+a,t+=r.keys.length,e.parentArgsLen=t),this.add(a||"/",e.callback,e,n)},this)},add:function(e,n,a,s){"object"==typeof n&&(s=a,a=n),s||(s=this.routeView);var o=s.routes;if("/"!==e.charAt(0))throw"path必须以/开头";var c=new i(e,n,a);t.Array.ensure(o,c);var u=a.children;if(u){delete a.children;var l={},d=s.options;t.each(h,function(e){e in u?l[e]=u[e]:l[e]=d[e]});var p=new r(c,l);routes=u.routes,delete u.routes,this._add(routes,p,e,c)}},navigate:function(e,t){"/"===e.charAt(1)&&(e=e.slice(1)),a.push(e,t)},$types:n};t.extendByBase(c),a.on("change",function(e,n,i){var r=!1;i||(r=!0);var a=t.history.parseUrl(n.url);a&&c.route(a.path,a.query,{first:r,direction:e,state:n,oldState:i})}),t.router=c,module.exports=t},function(module,exports,e){function t(e){var t=C.getPath(e);return t?n.parseQuery(t):null}var n=e(2),i=window,r={},a=[],s=function(e){return e=e.replace(/[^\/]+$/,""),("/"+e+"/").replace(/^\/+|\/+$/g,"/")},o=function(){var e=n.document.getElementsByTagName("base");return e=e&&e.length?s(e[0].getAttribute("href")):"/"},h=n.parseLocation(),c=h.pathname,u=h.origin,l=i.history,d=(i.navigator||{}).userAgent;d||(d="");var p=parseInt((/android (\d+)/.exec(d.toLowerCase())||[])[1],10);isNaN(p)&&(p=void 0);var f=/Boxee/i.test(d),g=!(!(l&&l.pushState&&l.replaceState)||p<4||f),v=!!("onhashchange"in i),m={hashbang:1,history:2,"abstract":3},y="#!",w="",C={mode:m.hashbang,supportPushState:g,supportHashChange:v,support:g||v,startd:!1,index:-1,preIndex:-1,base:"/",checkMode:function(){var e=this;"abstract,history,hashbang".replace(n.rword,function(t){e.options[t]&&(e.mode=m[t])}),this.mode!==m.history||this.supportPushState||(this.mode=m.hashbang),this.support||(this.mode=m["abstract"])},start:function(e){if(!this.startd){e||(e={});var t=e.base;n.isDefined(t)&&n.isString(t)?this.base=s(t):this.base=o(),this.startd=!0,this.options=n.extend({},e),this.checkMode(),this.pathExt=C.getPath(c).slice(1),this.mode!==m["abstract"]&&i.addEventListener(this.mode===m.history?"popstate":"hashchange",this.onChange),n.document.addEventListener("click",this.onDocClick),this.onChange(),this.trigger("inited")}},stop:function(){this.mode!==m["abstract"]&&i.removeEventListener(this.mode===m.history?"popstate":"hashchange",this.onChange),n.document.removeEventListener("click",this.onDocClick),this.startd=!1,this.index=-1,r={},a=[]},getPath:function(e,t){var i=n.parseUrl(e),r=decodeURIComponent(i.pathname+(t?"":i.search)),a=this.base.slice(0,-1);return r.indexOf(a)||(r=r.slice(a.length)),r=r.slice(1),(r||C.base)&&(r&&"/"===r||(r="/"+(r||""))),r},onDocClick:function(e){if(e.which>1||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey)return!0;var t=e.target,i=n.getHrefAndTarget(t);t=i.target;var r=i.href;if(r&&t){var a=!t.target&&!t.hasAttribute("download")&&"external"!==t.getAttribute("rel");if(C.checkUrl(r)&&a){var s=n.getDatesetObj(t),o=C.createStateObject(r,s);return e.preventDefault(),C.pushState(o,!0),!1}}},checkUrl:function(e,t){t||(t=n.parseUrl(e).origin);var i=/^(javascript|mailto|tel):/i;return e&&u===t&&!i.test(e)},push:function(e,t){var n=this.createStateObject(e,t);this.pushState(n)},currentHref:function(){return n.location.href.replace(C.pathExt,"").replace(y+"/","")},pushState:function(e,t){if((t||this.checkUrl(e.url,e.origin))&&e.url!==C.getCurrentState().url){if(this.mode!==m["abstract"]&&e.url!==C.currentHref())if(this.mode===m.hashbang){if(n.isUndefined(e.data.href))return w=e,void(n.location.hash=y+e.rpath)}else n.isUndefined(e.data.href)&&l[e.replace?"replaceState":"pushState"](e,e.title,e.url);this.onChange({state:e})}},onChange:function(e){e&&"hashchange"===e.type&&(e.state=w);var t=e&&e.state||C.getUrlState(C.currentHref()),i=C.getCurrentState();w=null;var r;if(i&&t.rurl===i.rurl)return void("popstate"!==e.type&&t.hash&&(r=n.document.getElementById(t.hash),r&&r.scrollIntoView()));var a=C.storeState(t),s="";if(a>C.index)s="forward";else{if(!(a<C.index))return e.preventDefault(),!1;s="back"}"back"!==s&&"back"===t.data.rel?s="back":"back"===s&&"back"!==t.data.rel&&"back"===i.data.rel&&(s="forward"),n.document.title=t.title,a!==C.index&&(C.preIndex=C.index),C.index=a,C.trigger(s,t,i),C.trigger("change",s,t,i)},getUrlState:function(e){return e=n.getFullUrl(e),r[e]||this.createStateObject(e)},getCurrentState:function(){var e=a[this.index];return e?r[e]||null:null},getPrevState:function(){var e=a[C.preIndex];return e||(e=a[this.index-1])?r[e]||null:null},createStateObject:function(e,t){e?"/"===e.charAt(0)&&(e=e.slice(1),e=this.base+e):e=C.currentHref();var i=n.parseUrl(e);return{data:t||(t={}),title:t.title||n.document.title,rurl:i.rurl,url:i.url,path:i.pathname,rpath:C.getPath(e),origin:i.origin,hash:i.hash,replace:n.isString(t.replace)?"true"===t.replace:!!t.replace}},hasUrl:function(e){return!!r[e]},storeState:function(e){var t=-1,i=e.rurl,s=a.indexOf(i);return this.hasUrl(i)?t=s:(t=this.index+1,a.splice(t,0,i)),r[i]=n.extend(!0,r[i],e),this.clearCache(t),t},clearCache:function(e){n.isUndefined(e)&&(e=-1);var t=e+50,i=a.slice(t);i.forEach(function(e){delete r[e]}),a.length>t&&(a.length=t)},getCache:function(){return{urlCache:a,stateCache:r}},parseUrl:t};n.extendByBase(C),n.history=C,module.exports=n},function(module,exports){function e(e){if(!("classList"in e)){e.classList={node:e};for(var t in L)e.classList[t.slice(1)]=L[t]}return e.classList}function t(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function n(e){var t;e&&(t=c.getElementById(e),t&&t.scrollIntoView())}function i(e){var t=e.split("?"),n={},i=t[0],r=t[1];if(r)for(var a,s=r.split("&"),o=s.length,h=0;h<o;h++)s[h]&&(a=s[h].split("="),n[decodeURIComponent(a[0])]=decodeURIComponent(a[1]));return{path:i,query:n}}var r=window,a={},s=function(e,t,n){n||(n=null);for(var i=0,r=e.length;i<r&&!1!==t.call(n,e[i],i,e);i++);},o=function(e){return e+="",e.replace(/#.*/,"")},h=r.location,c=r.document,u=c.body,l=c.createElement("a"),d=function(e){return l.href=e,g(l)},p=function(e){return l.href=e,o(l.href)},f=function(e){e||(e=h);var t=e.hash;return"#"===t.charAt(0)&&(t=t.substr(1)),t},g=function(e){e||(e=h);var t=e.href,n=f(e),i=o(t);return n||(t=i),{url:t,rurl:i,host:e.host,hash:n,protocol:e.protocol,origin:e.origin||e.protocol+"//"+e.host,pathname:e.pathname,search:e.search,port:e.port}},v=function(e){var t="";do if(e!==u&&1===e.nodeType&&((t=e.getAttribute("data-href"))||(t=e.href)))break;while(e=e.parentElement);return{href:t||"",target:e}},m=function(e){return e.indexOf("-")<0?e:e.replace(/-[^-]/g,function(e){return e.charAt(1).toUpperCase()})},y=function(e){var t={};if(e.dataset)for(var n in e.dataset)t[n]=e.dataset[n];else for(var i,r,a=e.attributes,s=/^data-(.+)$/i,o=0,h=a.length;o<h;o++)i=a[o].name||a[o].nodeName,(r=i.match(s))&&(t[m(r[1])]=a[o].value||a[o].nodeValue);return t},w=Object.prototype,C=(w.hasOwnProperty,w.toString),b=function(e){return"[object Function]"==C.call(e)},x=function(e){return"[object Object]"===C.call(e)&&Object.getPrototypeOf(e)===w},S=a.extend=function(){var e,t,n,i,r,a,s=arguments[0]||{},o=1,h=arguments.length,c=!1;for("boolean"==typeof s&&(c=s,s=arguments[1]||{},o++),"object"==typeof s||b(s)||(s={}),o===h&&(s=this,o--);o<h;o++)if(null!=(e=arguments[o]))for(t in e)n=s[t],i=e[t],s!==i&&(c&&i&&(x(i)||(r=Array.isArray(i)))?(r?(r=!1,a=n&&Array.isArray(n)?n:[]):a=n&&x(n)?n:{},s[t]=S(c,a,i)):void 0!==i&&(s[t]=i));return s};a.nextTick=new function(){return function(e){setTimeout(e)}};var k={_eventData:null,on:function(e,t){this._eventData||(this._eventData={}),this._eventData[e]||(this._eventData[e]=[]);var n=!1;s(this._eventData[e],function(e){if(e===t)return n=!0,!1}),n||this._eventData[e].push(t)},off:function(e,t){this._eventData||(this._eventData={}),this._eventData[e]&&this._eventData[e].length&&(t?s(this._eventData[e],function(n,i){if(n===t)return this._eventData[e].splice(i,1),!1}):this._eventData[e]=[])},trigger:function(e){if(this._eventData||(this._eventData={}),this._eventData[e]){var t=this._eventData[e].slice.call(arguments,1);s(this._eventData[e],function(e){e.apply(null,t)})}}},V=function(){},A="m-"+(new Date).getTime()+"-",E=1,_={},T=function(e){var t="";return e&&(t=_[e])||(t=A+E++,e&&(_[e]=t)),t},I=/[^, ]+/g,D=/^\[object SVG\w*Element\]$/,L={_toString:function(){var e=this.node,t=e.className,n="string"==typeof t?t:t.baseVal;return n.split(/\s+/).join(" ")},_contains:function(e){return(" "+this+" ").indexOf(" "+e+" ")>-1},_add:function(e){this.contains(e)||this._set(this+" "+e)},_remove:function(e){this._set((" "+this+" ").replace(" "+e+" "," "))},__set:function(e){e=e.trim();var t=this.node;D.test(t)?t.setAttribute("class",e):t.className=e}};"add,remove".replace(I,function(t){a[t+"Class"]=function(n,i){return i&&"string"==typeof i&&n&&1===n.nodeType&&i.replace(/\S+/g,function(i){e(n)[t](i)}),this}}),"undefined"!=typeof $&&b($.prototype.html)?a.innerHTML=function(e,t){$(e).html(t)}:a.innerHTML=function(e,t){e.innerHTML=t},a.extend({rword:I,noop:V,each:s,trimUrl:o,parseUrl:d,getHash:f,getFullUrl:p,getHrefAndTarget:v,camelize:m,getDatesetObj:y,isFunction:b,isArray:function(e){return Array.isArray(e)},isString:function(e){return"string"==typeof e},isUndefined:function(e){return"undefined"==typeof e},isDefined:function(e){return"undefined"!=typeof e},isPlainObject:x,parseLocation:g,getUIDByKey:T,getShortId:function(e){return e&&e.split("-")[2]},hasClass:function(t,n){return 1===t.nodeType&&e(t).contains(n)},removeEle:t,scrollToHash:n,parseQuery:i,location:h,document:c,body:u,html:c.documentElement,Base:k,extendByBase:function(e){return S(e,k)},Array:{ensure:function(e,t){if(e.indexOf(t)===-1)return e.push(t)},indexOfByKey:function(e,t,n){for(var i=t[n],r=0,a=e.length;r<a;r++)if(e[r][n]===i)return r;return-1}}}),module.exports=a},function(module,exports){module.exports={date:{pattern:"[0-9]{4}-(?:0[1-9]|1[0-2])-(?:0[1-9]|[1-2][0-9]|3[0-1])",decode:function(e){return new Date(e.replace(/\-/g,"/"))}},string:{pattern:"[^\\/]*"},bool:{pattern:"0|1",decode:function(e){return 0!==parseInt(e,10)}},"int":{pattern:"\\d+",decode:function(e){return parseInt(e,10)}}}},function(module,exports,e){function t(e,t,i){i=i||{},i.callback=t||r.noop,e.length>2&&"/"===e.charAt(e.length-1)&&(e=e.slice(0,-1),i.last="/"),i=n(e,i),delete i.path,delete i.last,this.routeView=null,this.instances=[],this.path=e,this.activeIndex=-1,r.each(["cacheTemplate","animation","aniClass","redirectTo","redirectPushState","callback","getTemplate","onActive","onDestroy","onEnter","onLeave","regexp","$regexp","keys","parentArgsLen"],function(e){this[e]=i[e],delete i[e]},this);var a=this.redirectTo;r.isString(a)&&(a=this.redirectTo=function(){return a}),a&&r.isUndefined(this.redirectPushState)&&(this.redirectPushState=!0),this.parentArgsLen||(this.parentArgsLen=0),this.options=i}function n(e,t){for(var n,r,s,h,c=t.keys=[],u="boolean"!=typeof t.caseInsensitive||t.caseInsensitive,l="^",d=0;n=o.exec(e);){r=n[2]||n[3],s=n[4]||("*"==n[1]?".*":"string"),h=e.substring(d,n.index);var p=a[s],f={name:r};p&&(s=p.pattern,f.decode=p.decode),c.push(f),l+=i(h,s,!1),d=o.lastIndex}return h=e.substring(d),l+=i(h),t.children&&(t.$regexp=new RegExp(l,u?"i":void 0)),l+=(t.strict?t.last:"/?")+"$",t.regexp=new RegExp(l,u?"i":void 0),t}function i(e,t,n){var i=e.replace(/[\\\[\]\^$*+?.()|{}]/g,"\\$&");if(!t)return i;var r=n?"?":"";return i+r+"("+t+")"+r}var r=e(2),a=e(3),s=e(5),o=/([:*])(\w+)|\{(\w+)(?:\:((?:[^{}\\]+|\\.|\{(?:[^{}\\]+|\\.)*\})+))?\}/g;r.extend(t.prototype,{ins:function(e,t,n,i){var a=this,o=null;return r.each(a.instances,function(r,s){if(a.checkEqual(r,e,t))return o=r,a.setActive(s),o.setOptions(i),o.setArgs(n),!1}),o?o:(o=new s(this,e,t,n,i),this.instances.push(o),this.setActive(this.instances.length-1),o)},checkEqual:function(e,t,n){return e.path===t},getIns:function(e){return this.instances[e]},getActive:function(){return this.getIns(this.activeIndex)},setActive:function(e){this.activeIndex=e},setRouteView:function(e){this.routeView=e},ele:function(){var e=this.getActive()||null;return e&&e.element},destroyIns:function(e){if(e){return this.getActive()===e?(this.instances.splice(this.activeIndex,1),this.setActive(-1),void e.destroy()):void r.each(this.instances,function(t,n){if(t===e)return this.instances.splice(n,1),this.activeIndex>n&&this.setActive(this.activeIndex-1),e.destroy(),!1},this)}}}),module.exports=t},function(module,exports,e){function t(e,t,n,i,a){this.route=e,this.path=t,this.query=n,this.options=a,this.params={},this.args=null,this.element=null,this.cached=!1,this._oldTemplate="",this.destroyed=!1,this.setArgs(i);var s=r.getUIDByKey(this.path);this.options&&this.options.parentUID&&(s=this.options.parentUID+"-"+r.getShortId(s)),this.id=s}function n(e,t,n){for(var i=0,r=t.length;i<r;i++){var a=t[i],s=e[i]||"";if("function"==typeof a.decode)var o=a.decode(s);else try{o=JSON.parse(s)}catch(h){o=s}e[i]=n.params[a.name]=o}n.args=e}function i(e){var t=e.args;if(!t)return void(e.args=[]);if(e.route.keys.length){var n=e.route.parentArgsLen;t.splice(0,n)}else t.length=0}var r=e(1);r.extend(t.prototype,{setArgs:function(e){this.route.keys.length?(n(e,this.route.keys,this),i(this)):this.args=[]},setOptions:function(e){this.destroyed||(this.options=e)},setEle:function(e){this.element=e},equalTo:function(e,t){var n=r.history.parseUrl(e);return!(!n||!this.route.checkEqual(this,n.path,n.query))&&(t&&(this.query=n.query),!0)},isParentOf:function(e){var t=this.route.$regexp;if(t){var n=e.match(t);if(n&&n[0]===this.path)return!0}return!1},destroy:function(){this.destroyed||(this.route=null,this.path="",this.query=null,this.options=null,this.params=null,this.args=null,this.element&&r.removeEle(this.element),this.element=null,this.destroyed=!0)}}),module.exports=t},function(module,exports,e){function t(e,t){e&&e.setRouteView(this),this.routes=[],this.maskEle=null,this.pageViewState=null,this.viewsContainer=null,this.options=t,this.pagesCache=[],this.templateCache={},this.options.cacheViewsNum<1&&(this.options.cacheViewsNum=1),this.options.maskClass||(this.options.maskClass="mask"),this.options.maskClass=this.options.maskClass.replace(/^\s+|\s+$/g,"").replace(/\s+/g," "),e||this.setViewsContainer(i.document.body)}function n(e,t){if(!e.destroyed){var n=e.route[t];return i.isFunction(n)&&n.apply(e,e.args)}}var i=e(2),r=i.document.createElement("div"),a=function(){for(var e,t=r.style,n=["a","webkitA","MozA","OA","msA"],i=["animationend","webkitAnimationEnd","animationend","oAnimationEnd","MSAnimationEnd"],a=0,s=n.length;a<s;a++)if(e=n[a]+"nimation",e in t)return i[a];return"animationend"}(),s="page-view",o="in",h="out",c="reverse",u="ani",l="overhidden",d=o+" "+c;i.extend(t.prototype,{route:function(e,t,n){return n||(n={}),this._match("regexp",e,t,n)||this._match("$regexp",e,t,n)},_match:function(e,t,n,i){e||(e="regexp");for(var r,a,s=0;r=this.routes[s];s++)if(r[e]&&(a=t.match(r[e])))return this._matched(r,t,a,n,i),!0;return!1},_matched:function(e,t,n,r,a){var s=n.shift();routeIns=e.ins(s,r||{},n,a),routeIns.targetPath=t,this._route(routeIns,function(){e.routeView&&!routeIns.destroyed&&(e.routeView.route(t,routeIns.query,i.extend({parentUID:routeIns.id},a))||e.routeView.pageViewState&&e.routeView.pageViewState.path!==routeIns.targetPath&&e.routeView.leave(a))})},_redirectTo:function(e,t){function r(){!e.element&&s.destroyIns(e);var n={_redirectedOriginPath:e.path};t||(n.redirectToSync=!0),s.redirectPushState||(n.href=a),i.router.navigate(a,n)}var a,s=e.route;return!(e.path!==e.targetPath||!s.redirectTo||!(a=n(e,"redirectTo"))||e.equalTo(a,!0)||a===e.targetPath)&&(t?i.nextTick(r):r(),!0)},_getDefaultEle:function(e){var t;return this.pageViewState||!(t=this.viewsContainer.getElementsByClassName(s)[0])||t.id&&t.id!==e.id?null:t},_setDefTemplateCache:function(e){var t=e.element,n=!1;if(t&&e.options.first){if(e.route.routeView){var r=t.getElementsByClassName(s),a=[];i.each(r,function(e){e.parentNode==t&&(i.removeEle(e),a.push(e))}),this.templateCache[e.path]=t.innerHTML,i.each(a,function(e){t.appendChild(e)}),r=null,a=null}else this.templateCache[e.path]=t.innerHTML;n=!!this.templateCache[e.path]}return n},_route:function(e,t){function r(n){s.getTemplateCb(e,n,t)}if(e===this.pageViewState)return this._redirectTo(e,!0),t();var a=e.route,s=this,o=this.getOption(a,e.options.state,"cacheTemplate"),h=this._getDefaultEle(e);e.setEle(h),this._setDefTemplateCache(e)&&(o=!0),i.isString(o)&&(o="true"===o);var c=e.args;if(o&&this.templateCache[e.path]||!a.getTemplate){if(!a.getTemplate&&this._redirectTo(e,!0))return;n(e,"onActive"),i.router.trigger("routeChangeStart",e,c),r(this.templateCache[e.path])}else n(e,"onActive"),i.router.trigger("routeChangeStart",e,c),this.pageViewState&&this.pageViewState.element&&i.addClass(this.pageViewState.element,"on-out"),this.showLoading(),a.getTemplate.length>0?a.getTemplate.call(e,r):r(a.getTemplate.call(e))},setViewsContainer:function(e){var t,n;e&&(n=this.options.viewsSelector,t=n&&e.querySelector(n)),this.viewsContainer=t||e||null},showLoading:function(e){if(this.options.showLoading||e){var t=this.viewsContainer.querySelector(this.options.maskClass.replace(/^|\s/g,"."));t||this.initMaskEle(),this.maskEle.style.visibility="visible"}},initMaskEle:function(){this.maskEle=r.cloneNode(),this.maskEle.className=this.options.maskClass,this.maskEle.innerHTML='<i class="'+this.options.maskClass+'-loading"></i>',this.viewsContainer.appendChild(this.maskEle)},hideLoading:function(){this.maskEle&&(this.maskEle.style.visibility="hidden")},getOption:function(e,t,n){if((e||t)&&n){var r;return t&&(r=t.data[n]),e&&i.isUndefined(r)&&(r=e[n],i.isUndefined(r)&&(r=this.options[n])),r}},getTemplateCb:function(e,t,r){this.hideLoading(),e._oldTemplate=this.templateCache[e.path],this.templateCache[e.path]=t||"";var a,s=this,o=e.options,h=this.pageViewState,c=e.id;if(this.pageViewState||(a=e.element),this.viewsContainer&&!e.destroyed){var u=i.document.getElementById(c);u?e.cached=!0:(u=a||i.document.createElement("div"),u.id=c,e.cached=!1,!a&&this.viewsContainer.appendChild(u)),e.setEle(u),this._initEle(u);var l=e.route;(e.cached||a)&&t===e._oldTemplate||(i.innerHTML(u,t),e.cached=!1);var d=l.routeView,p=i.Array.indexOfByKey(s.pagesCache,e,"path");~p&&s.pagesCache.splice(p,1),s.pagesCache.push(e),d&&d.setViewsContainer(e.element),r&&r(),this._transView(e,o,function(){h&&h.element&&i.removeClass(h.element,"on-out"),n(e,"callback"),i.router.trigger("routeChangeEnd",e,e.args),s._redirectTo(e)})}},_initEle:function(e){i.removeClass(e,d),i.addClass(e,s+" "+h+" "+this.options.viewClass)},leave:function(e){if(this.pageViewState&&!this.pageViewState.destroyed){var t=this.pageViewState.route.routeView;this._transView(this.pageViewState,e,function(){t&&(e=i.extend({},e),e.first=!0,t.leave(e))})}},_transView:function(e,t,r){function s(e,t){t&&e.removeEventListener(a,t)}function p(){return y?(w&&w.route&&w.route.getActive()!==b.pageViewState&&w.route.routeView&&w.route.routeView.leave(t),void f()):(r&&r(),f(),void(e===b.pageViewState&&(b.pageViewState=null)))}function f(){V&&A&&(i.removeClass(b.viewsContainer,l),b.checkPageViews(e))}var g=o,v=h,m=v,y=e.element,w=this.pageViewState,C=w&&w.element,b=this;this.pageViewState=e,w===e&&(y=null,this.pageViewState=null);var x=this._shouldAni(this.options.animation,e,t);if(x=x&&!e.options.state.data.redirectToSync){var S=u,k=u;S+=" "+this.getOption(e.route,t.state,"aniClass"),!t.first&&w&&(k+=" "+this.getOption(w.route,t.oldState,"aniClass")),g=S+" "+g,v=k+" "+v,i.addClass(this.viewsContainer,l)}"back"===t.direction&&(g+=" "+c,v+=" "+c),C&&(i.removeClass(C,d),i.addClass(C,v),C.offsetWidth=C.offsetWidth,n(w,"onLeave"),w.route.getActive()===w&&w.route.setActive(-1)),y&&(i.removeClass(y,m),i.addClass(y,g),y.offsetWidth=y.offsetWidth,n(e,"onEnter")),!e.cached&&t.state.hash&&i.scrollToHash(t.state.hash);var V=!y,A=!C;return x?(y&&y.addEventListener(a,function E(){V=!0,s(y,E),i.removeClass(y,S),r&&r(),f()}),void(C&&C.addEventListener(a,function _(){A=!0,s(C,_),i.removeClass(C,k),p()}))):(V=!0,A=!0,r&&r(),void p())},_shouldAni:function(e,t,n){var i=this.getOption(t.route,n.state,"animation"),r=e;return!n.first&&this.pageViewState&&(r=this.getOption(this.pageViewState.route,n.oldState,"animation")),i=1==i||"true"==i,r=1==r||"true"==r,e=i&&r&&!n.first},checkPageViews:function(e){var t=this.options.cacheViewsNum,n=this.pagesCache;if(!(n.length<=t)){var r=i.Array.indexOfByKey(n,e,"path"),a=0,s=0;for(a=r-Math.floor((t-1)/2),a<0&&(a=0),s=t-1+a,s>n.length-1&&(a-=s-n.length+1,s=n.length-1);a>0;)this.destroyRouteIns(n.shift()),a--,s--;for(;s<n.length-1;)this.destroyRouteIns(n.pop())}},destroyRouteIns:function(e){if(!e.destroyed){var t=e.route,r=t.routeView,a=this.pageViewState&&this.pageViewState.route;if(r&&(!r.pageViewState||t!==a)){for(var s=r.pagesCache.shift();s;)r.destroyRouteIns(s),s=r.pagesCache.shift();r.pageViewState=null,a&&t.ele()==this.pageViewState.element||r.setViewsContainer(null),i.removeEle(r.maskEle),r.maskEle=null}n(e,"onDestroy"),t.destroyIns(e),e=null}},getTemplateCache:function(){return this.templateCache}}),module.exports=t}])});